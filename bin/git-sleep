#!/usr/bin/env ruby

require 'rubygems'
require 'netrc'
require File.expand_path('../../lib/git-sleep', __FILE__)

n = Netrc.read(GitSleep::NETRC_PATH)

help_text = "Available commands:
    git sleep authorize
    git sleep init"

case ARGV.length
when 0
  puts help_text
when 1
  case ARGV.first.downcase.to_sym
  when :init
    current_path = File.expand_path(".")
    if Dir.entries(current_path).include?(".git")
      puts "This is a git repo, so I'll now install the hook"
    else
      puts "This is not a git repo!"
    end
  when :authorize
    puts "Visit #{GitSleep::OUR_SITE} to get the necessary information"
    puts "what is your xid?"
    print "> "
    xid = $stdin.gets.chomp
    puts "what is your token?"
    print "> "
    token = $stdin.gets.chomp
    n.new_item_prefix = "\n# jawbone xid and sleepytime token\n"
    n["sleepytime.com"] = xid, token
    n.save
  else # unrecognized command
    puts help_text
  end
else # other amounts of arguments
  puts help_text
end